# ============LICENSE_START====================================================
# =============================================================================
# Copyright (C) 2020 QCT
# =============================================================================
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ============LICENSE_END======================================================

#author: Kate Hsuan (kate.hsuan@qct.io)

tosca_definitions_version: cloudify_dsl_1_3
imports:
  - http://www.getcloudify.org/spec/cloudify/3.4/types.yaml
  - https://nexus.onap.org/service/local/repositories/raw/content/org.onap.dcaegen2.platform.plugins/R5/k8splugin/1.4.13/k8splugin_types.yaml
inputs:
  spring.datasource.url:
    type: string
    description: MariaDB URL 
    default: "jdbc:mariadb://dl-mariadb:3306/datalake?autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=UTF-8"
  spring.datasource.username:
    type: string
    description: MariaDB Username
    default: 'dl'
  spring.datasource.password:
    description: MariaDB password
    type: string
    default: dl1234
  dmaapZookeeperHostPort:
    type: string
    description: zookeeper URL fqdn:port
    default: message-router-zookeeper:2181
  dmaapKafkaHostPort:
    type: string
    description: Kafka URL fqdn:port
    default: message-router-kafka:9092
  dmaapKafkaGroup: 
    type: string
    description: Kafka access group 
    default: "dlgroup44"
  couchbaseURL:
    type: string
    description: Couchbase URL fqdn:port 
    default: "172.30.1.74:8093"
  mongoDBURL:
    type: string
    description: MongoDB URL fqdn:port
    default: "172.30.1.74:27017"
  hdfsURL:
    type: string
    description: hdfs URL fqdn:port
    default: "172.30.1.74:8020"
  esURL:
    type: string
    description: Elasticsearch URL fqdn:port
    default: 172.30.1.74:9200
node_templates:
  datalake:
    type: dcae.nodes.ContainerizedPlatformComponent
    interfaces:
      cloudify.interfaces.lifecycle:
        start:
          inputs:
            ports: []
    properties:
      application_config:
        spring.datasource.url:
          get_input: spring.datasource.url
        spring.datasource.username:
          get_input: spring.datasource.username
        spring.datasource.password:
          get_input: spring.datasource.password
        dmaapZookeeperHostPort:
          get_input: dmaapZookeeperHostPort
        dmaapKafkaHostPort:
          get_input: dmaapKafkaHostPort
        dmaapKafkaGroup:
          get_input: dmaapKafkaGroup
        couchbaseURL:
          get_input: couchbaseURL
        mongoDBURL:
          get_input: mongoDBURL
        hdfsURL:
          get_input: hdfsURL
        esURL:
          get_input: esURL
      docker_config:
        interval: 30s
        timeout: 10s
        type: http
        endpoint: actuator/health
      image: registry.hub.docker.com/mizunoami123/datalake-feeder
      dns_name: "datalake"
      name: datalake
